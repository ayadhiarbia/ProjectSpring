<!-- Upcoming Tasks (continued) -->
<div class="col-md-3">
    <div class="task-item text-center p-3">
        <div class="bg-info bg-opacity-10 p-3 rounded-circle d-inline-block mb-2">
            <i class="fas fa-chart-line text-info fa-2x"></i>
        </div>
        <h6>Statistics</h6>
        <p class="text-muted small">Monthly report due</p>
        <button class="btn btn-sm btn-outline-info">Generate</button>
    </div>
</div>
</div>
</div>
</div>
</div>

<!-- Floating Action Button -->
<button class="btn btn-success floating-action-btn" data-bs-toggle="modal" data-bs-target="#quickActionModal">
    <i class="fas fa-plus"></i>
</button>

<!-- Modals -->
<!-- Add Prescription Modal -->
<div class="modal fade" id="addPrescriptionModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Prescription</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="prescriptionForm">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Select Patient *</label>
                            <select class="form-select" required>
                                <option value="">Choose patient...</option>
                                <option>John Doe (ID: P001)</option>
                                <option>Jane Smith (ID: P002)</option>
                                <option>Michael Brown (ID: P003)</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Date *</label>
                            <input type="date" class="form-control" value="2024-01-15" required>
                        </div>
                        <div class="col-12 mb-3">
                            <label class="form-label">Medication Details *</label>
                            <textarea class="form-control" rows="3" placeholder="Enter medication details..." required></textarea>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Dosage</label>
                            <input type="text" class="form-control" placeholder="e.g., 500mg">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Frequency</label>
                            <input type="text" class="form-control" placeholder="e.g., Twice daily">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Duration</label>
                            <input type="text" class="form-control" placeholder="e.g., 7 days">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Refills</label>
                            <input type="number" class="form-control" value="0" min="0">
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" form="prescriptionForm" class="btn btn-success">Save Prescription</button>
            </div>
        </div>
    </div>
</div>

<!-- Quick Action Modal -->
<div class="modal fade" id="quickActionModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Quick Actions</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-2">
                    <div class="col-6">
                        <button class="btn btn-outline-primary w-100 mb-2" onclick="window.location.href='/medecin/rendezvous'">
                            <i class="fas fa-calendar-plus me-2"></i>New Appointment
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-success w-100 mb-2" data-bs-toggle="modal" data-bs-target="#addPrescriptionModal">
                            <i class="fas fa-prescription me-2"></i>New Prescription
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-info w-100 mb-2" onclick="window.location.href='/medecin/patients'">
                            <i class="fas fa-user-plus me-2"></i>Add Patient
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-warning w-100 mb-2">
                            <i class="fas fa-file-medical me-2"></i>Medical Note
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Emergency Consultation Modal -->
<div class="modal fade" id="emergencyModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-warning text-white">
                <h5 class="modal-title"><i class="fas fa-exclamation-triangle me-2"></i>Emergency Consultation</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="alert alert-warning">
                    <i class="fas fa-info-circle me-2"></i>
                    A patient has requested an emergency consultation. Would you like to start immediately?
                </div>
                <div class="text-center">
                    <button class="btn btn-warning btn-lg">
                        <i class="fas fa-play me-2"></i>Start Emergency Consultation
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // Filter schedule function
    function filterSchedule(filter) {
        const items = document.querySelectorAll('.consultation-item');
        const buttons = document.querySelectorAll('.btn-group .btn');

        // Update active button
        buttons.forEach(btn => {
            btn.classList.remove('active');
            if (btn.textContent.toLowerCase().includes(filter)) {
                btn.classList.add('active');
            }
        });

        // Filter items
        items.forEach(item => {
            const status = item.getAttribute('data-status');
            if (filter === 'all' || status === filter) {
                item.style.display = 'block';
            } else {
                item.style.display = 'none';
            }
        });
    }

    // Update stats with animation
    function updateDoctorStats() {
        const stats = {
            'todayAppointments': {min: 5, max: 12},
            'waitingPatients': {min: 0, max: 5},
            'totalPatients': {min: 140, max: 150},
            'pendingReviews': {min: 5, max: 10}
        };

        for (const [id, range] of Object.entries(stats)) {
            const element = document.getElementById(id);
            const current = parseInt(element.textContent);
            const change = Math.random() > 0.3 ? 1 : -1;
            const newValue = Math.max(range.min, Math.min(range.max, current + change));

            if (newValue !== current) {
                element.textContent = newValue;
                element.classList.add('text-success');
                setTimeout(() => {
                    element.classList.remove('text-success');
                }, 1000);
            }
        }
    }

    // Simulate emergency notification
    function simulateEmergency() {
        if (Math.random() > 0.9) { // 10% chance
            const modal = new bootstrap.Modal(document.getElementById('emergencyModal'));
            modal.show();
        }
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
        // Auto-update stats every 30 seconds
        setInterval(updateDoctorStats, 30000);

        // Simulate emergency notification (every 2 minutes)
        setInterval(simulateEmergency, 120000);

        // Notification bell animation
        const notificationBell = document.getElementById('doctorNotificationDropdown');
        if (notificationBell) {
            notificationBell.addEventListener('click', function() {
                const badge = this.querySelector('.badge');
                badge.classList.add('animate__animated', 'animate__headShake');
                setTimeout(() => {
                    badge.classList.remove('animate__animated', 'animate__headShake');
                }, 1000);
            });
        }

        // Real-time updates for waiting patients
        function updateWaitingPatients() {
            const waitingBadge = document.querySelector('.card-header .badge');
            if (waitingBadge) {
                const current = parseInt(waitingBadge.textContent);
                const newValue = Math.max(0, Math.min(5, current + (Math.random() > 0.5 ? 1 : -1)));
                if (newValue !== current) {
                    waitingBadge.textContent = newValue + ' waiting';
                    waitingBadge.classList.add('animate__animated', 'animate__pulse');
                    setTimeout(() => {
                        waitingBadge.classList.remove('animate__animated', 'animate__pulse');
                    }, 1000);
                }
            }
        }

        // Update waiting patients every minute
        setInterval(updateWaitingPatients, 60000);

        // Auto-save quick notes
        const notesTextarea = document.querySelector('textarea');
        const saveButton = document.querySelector('.btn-sm.btn-primary');

        if (notesTextarea && saveButton) {
            notesTextarea.addEventListener('input', function() {
                saveButton.innerHTML = '<i class="fas fa-save me-1"></i>Save Changes';
            });

            saveButton.addEventListener('click', function() {
                this.innerHTML = '<i class="fas fa-check me-1"></i>Saved!';
                this.classList.remove('btn-primary');
                this.classList.add('btn-success');

                setTimeout(() => {
                    this.innerHTML = '<i class="fas fa-save me-1"></i>Save Note';
                    this.classList.remove('btn-success');
                    this.classList.add('btn-primary');
                }, 2000);
            });
        }
    });

    // Consultation start button handler
    document.querySelectorAll('.consultation-item .btn-success').forEach(button => {
        button.addEventListener('click', function() {
            const item = this.closest('.consultation-item');
            const patientName = item.querySelector('h6').textContent.split(' - ')[0];

            // Update button state
            this.innerHTML = '<i class="fas fa-spinner fa-spin me-1"></i>Starting...';
            this.disabled = true;

            // Simulate consultation start
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-play me-1"></i>Start';
                this.disabled = false;
                alert('Starting consultation with ' + patientName);
            }, 1500);
        });
    });
</script>

<!-- Add CSS for timeline -->
<style>
    .timeline {
        position: relative;
        padding-left: 30px;
    }

    .timeline-item {
        position: relative;
        padding-bottom: 20px;
    }

    .timeline-item:last-child {
        padding-bottom: 0;
    }

    .timeline-marker {
        position: absolute;
        left: -30px;
        top: 5px;
        width: 12px;
        height: 12px;
        border-radius: 50%;
        border: 3px solid white;
    }

    .timeline-content {
        padding-left: 15px;
    }

    .timeline-item:before {
        content: '';
        position: absolute;
        left: -24px;
        top: 20px;
        bottom: -5px;
        width: 2px;
        background-color: #e9ecef;
    }

    .timeline-item:last-child:before {
        display: none;
    }

    /* Animation classes */
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    .animate__pulse {
        animation: pulse 1s ease-in-out;
    }

    @keyframes headShake {
        0% { transform: translateX(0); }
        6.5% { transform: translateX(-6px) rotateY(-9deg); }
        18.5% { transform: translateX(5px) rotateY(7deg); }
        31.5% { transform: translateX(-3px) rotateY(-5deg); }
        43.5% { transform: translateX(2px) rotateY(3deg); }
        50% { transform: translateX(0); }
    }

    .animate__headShake {
        animation: headShake 1s ease-in-out;
    }
</style>
</body>
</html>